## 6. 입출력 구조
#### 1. 시스템 버스
1. 버스와 메모리 전송
* 전형적인 디지털 컴퓨터는 많은 레지스터와 레지스터들 사이의 정보 전송을 위한 경로를 가짐
* 시스템은 이를 위해 각 레지스터들 사이를 연결하는 번거로움 대신 공통의 버스(bus: 한번에 하나의 전송 만이 이루어지도록 신호를 이용하여 해당 레지스터를 선별) 시스템이라는 효율적 방법을 사용
* CPU 가 행하는 중요한 기능 중 하나는 외부 주변 장치(입출력 장치) 및 통신(network) 의 주체로서 정보의 입출력을 관장
    * BUS Adapter -> 입출력 버스를 시스템 버스 라인에 연결
    * 입출력 제어기 (I/O controller: 입출력 인터페이스) -> 입출력 속도 및 유사한 동작 특성 단위로 입출력 장치들을 제어 관리 하는 장치
    
2. 시스템 버스와 I/O 버스 간 상호 중재
* 컴퓨터 시스템에는 각 요소들 사이의 정보 전송을 위한 다양한 단계의 여러 버스가 존재
   * CPU 내에서도 레지스터와 ALU 사이의 정보 전송을 위한 여러 내부 버스 존재
   * 메모리 버스 -> 데이터, 주소, 그리고 읽기/쓰기 정보 전송
   * I/O 버스 -> 입출력 장치로 정보를 주고 받는데 사용
    
* 데이터 라인 -> 프로세스와 공통 메모리 사이의 데이터 전송 경로 제공(16~32 line 이 일반적, 양방향 정보 전송)
    * 데이터 전송 모드
        * 동기 : source & target 장치간 공통 clock 구동에 의해 정해진 시 분할 동안 데이터가 전송
        * 비동기 : 각 장치들을 독립적 클럭으로 동기화, source & target 장치간 핸드 쉐이킹 제어신호에 의해 각 데이터를 전송
    * 주소라인 -> 메모리 주소와 입출력 포트 식별에 활용(단 방향정보 전송)
    * 제어장치 -> 장치들 간의 정보 전송을 제어하는 신호를 제공
        * Timing signal : 데이터와 주소 정보의 유효성 체크
        * Command line : 수행 할 동작을 지정
    * 제어라인 -> 장치들 간의 정보 전송을 제어하는 신호를 제공
        * 전송 신호 : 메모리 읽기와 쓰기 등
            * 메모리 I/O 모두를 포함, 주소 라인은 독립된 메모리와 I/O 공간의 지정을 위해 활용
        * 전송의 승낙(acknowledge)
          * 전송이 완료 되었음을 알리는데 사용
        * 인터럽트 요구 
            * 8 개의 인터럽트 요구 명령과 1개의 승낙 명령으로 구성
            * 우선 순위 인터럽트 제어기에 연결되어 활용
        * 버스 제어 신호 
            * 버스 요구 및 버스 승인(grant) 등
            * bus lock -> 멀티 프로세서 응용에서 검사와 설정이 실행 되는 동안 다른 프로세서가 버스를 계속 잡고 있지 못하도록 막아줌
        * 중재 절차를 위한 신호 등으로 구성
    

* 공유 메모리 멀티 프로세서 시스템에서 프로세서는 시스템 버스를 통하여 공유 자원에 대한 접근을 요구
    * 공유 자원이 사용되고 있지 않을 경우 -> 바로 사용 승인
    * 공유 자원이 사용되고 있을 경우 -> 선점 프로세스의 종료까지 대기 상태 유지
    * 동시에 시스템 버스를 요구하는 경우 -> 공유 자원에 대한 충돌을 해결하기 위한 중재(arbitration) 동작이 수행
    
3. 시스템 버스의 활용
* 직렬 중재 절차(시스템 버스 제어기 : 중재를 위한 논리 회로 내장)
    * 가장 높은 중재자의 PI 는 항상 1 (버스 신청 시 항상 할당) 이고 PO 는 0
      * 만약 해당 중재자가 버스의 사용을 원치 않는다면 해당 중재자의 PI = 0, PO = 1 이 되어 다음 중재자로 전송
    * BUS busy line 활용 -> 사용 중인 버스를 특정 중재자가 할당 받고자 할 경우 활용 되는 기법
        * 해당 중재자 (PI = 1 이고 PO = 0 을 할당 받은 경우)는 bus 신청 전 Bus busy line 의 상태를 확인
        * Bus busy line 비 활성 상태 : 해당 프로세서는 버스 라인을 할당 받고 ->  Bus busy line 을 활성 상태로 변경
        * Bus Busy line 활성 상태
            * 이는 낮은 우선 순위의 프로세서가 버스를 사용하고 있다는 의미 이므로 이 프로세서가 버스 사용을 완료하고 비지 라인을 비활성 상태로 전환할 때까지 대기
    * 우선 순위를 바탕으로 Daisy-chain 연결로 중재 하는 방법 제시
    

* 병렬 중재 논리
    * 각 버스 중재자는 버스 요청 출력라인 (Req) 버스 승락 (Ack) 입력 라인 보유
    * 버스 비지 라인은 Daisy-chain 의 경우와 동일
    * BPRN(버스 우선 순위 입력) & BPRO(버스 우선 순위 출력) -> 버스 중재 회로의 데이지체인 연결에 활용
    * Busy(버스 혼잡 신호) -> 버스가 사용 중임을 모든 중재자에게 알리는 open collector 출력
    * CBRQ(공통버스 요구) -> open collector 출력, 우선 순위가 낮은 중재자가 현재 버스 사용 중
    * 각각의 acknowledge 와 request 에 BREQ(버스 요구) & BPRN(우선 순위 입력)을 연결해야 함, BCLK(버스 클럭)은 모든 버스 작업의 동기화에 활용
    
#### 2. 입출력 연결과 주소 지정
1. 입출력 주소 지정
* 입출력 주소 지정
    * 컴퓨터 시스템에는 다양한 입출력(I/O) 장치 및 통신 포트 등이 연결 됨
    * 서로 구분하기 위해 각 입출력 장치 또는 통신 포트에 고유한 주소 할당
    * 하나의 입출력 장치에 그 상태나 데이터의 입출력 등 용도에 따라 다수의 주소 할당이 가능
    * 일반 저장 공간에 할당된 주소에 비해 입출력 장치의 개수는 작기 때문
        * 메모리 맵 입출력(memory mapped I/O) -> 메모리에 부여된 주소 공간의 일부를 입출력 주소 공간으로 활용
            * 동일한 주소선과 제어선으로 입출력 관리 가능
            * 시스템은 지정된 주소 값에 의해 데이터 저장 공간과 I/O 장치 구분
            * 모든 CPU 에 대해 구현이 가능하나 H/W 적(주소 값에 따라) 분류 접근 구현이 필요
        * 입출력 맵 입출력(I/O mapped I/O) -> 독립된 메모리 주소 공간과 입출력 주소 공간을 구분하여 할당
            * 메모리와 입출력 주소를 구분하는 제어 선을 사용
            * 상호 구분되는 명령어(서ㅏㅇ호 동일한 주소일 경우)가 필요
            * 제어 신호를 통해 메모리/입출력 장치에 접근이 가능하도록 H/W 적 구현이 필요
    * 메모리 맵 입출력 (memory mapped I/O) 은 모든 CPU 에서 구현이 가능하나 입출력 맵 입출력 (I/O mapped I/O) 의 경우 I/O 용 별도의 명령어와 이를 위한 외부 제어선이 있는 CPU 에서만 구현이 가능
        * PC 에서는 양자 모두 구현이 가능하다고 알려져 있음
    
2. 중앙 제어 버스 VS 분산 제어 버스
* 중앙제어 버스 시스템
    * 구현 및 관리가 용이 하나 제어기의 이상시 버스 중재 및 활용에 지대한 결함이 발생
    
* 분산 제어 버스 시스템
    * 분산 제어 버스 시스템
        * 버스상의 모든 장치가 제어 기능을 나누어 실행
    * I/O 버스는 주로 중앙 제어 버스 시스템을 적용
    * 시스템 버스로는 분산제어 버스 시스템을 선호
    
3. 입출력 버스 할당
* 동적 중재 알고리즘
    * 정적 우선 순위 알고리즘에 대해 시스템이 동작하고 있는 동안 장치들의 우선 순위를 변경 시킬 필요가 있을 경우 적용 가능한 알고리즘을 동적우선 순위 알고리즘이라고 함
    * 시간 분할(time slice) algorithm 
        * 연속적으로 주어지는 버스 시간을 고정된 길이의 시간 분할로 나누고 이를 라운드로빈(round-robin) 방식으로 각 프로세스에 할당
        * 버스에서의 위치에 관계없이 모든 요소들이 동등한 서비스를 받게 됨
    * 폴링(polling)을 이용한 버스 시스템
        * 폴(poll) 라인으로 버스 승인(grant) 신호를 대체 하여 모든 장치에 연결
        * 버스 제어기는 이 신호를 이용하여 각 장치의 주소를 결정
        * 지정된 순서에 따라 버스를 할당 받음
        * 프로그램으로 우선 순위 변경 가능
    * LRU(Least recently algorithm)
        * 가장 오랫동안 버스 서비스를 사용하지 못한 장치에게 우선권을 부여
        * 몇번의 버스 사이클 마다 LRU algorithm 에 의해 각 장치의 우선 순위가 계속 변경
        * 모든 프로세스가 버스에 접근 할 수 잇는 기회를 동등하게 부여 받을 수 있음
    * first-come & first-serve
        * 버스 제어기는 각 프로세스의 버스 요구 도착시간별 저장이 가능한 큐를 이용해 도착한 순서대로 서비스를 제공
    * 회전 데이티 체인 (rotating daisy chain) 방식
        * 모든 장치를 연결(closed loof) 하여 차례로 버스 서비스를 제공하는 방식
    